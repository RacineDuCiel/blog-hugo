{{/*
Shortcode: Onion Rendezvous Protocol (v3 - Mobile optimized)
Usage: {{< onion-rendezvous>}}
*/}}

<div class="onion-rv">
    <div class="onion-rv-nav">
        <button data-step="1" class="active">1</button>
        <button data-step="2">2</button>
        <button data-step="3">3</button>
        <button data-step="4">4</button>
        <button data-step="5">5</button>
        <button data-step="6">6</button>
        <div class="step-label" id="rv-step-label">Publication</div>
    </div>

    <svg viewBox="0 0 280 200" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <marker id="arr-p" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                <polygon points="0 0, 6 2.5, 0 5" fill="#9b59b6" />
            </marker>
            <marker id="arr-o" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                <polygon points="0 0, 6 2.5, 0 5" fill="#e67e22" />
            </marker>
            <marker id="arr-g" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                <polygon points="0 0, 6 2.5, 0 5" fill="#27ae60" />
            </marker>
            <marker id="arr-b" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
                <polygon points="0 0, 6 2.5, 0 5" fill="#3498db" />
            </marker>
        </defs>

        <g class="actor" data-actor="service">
            <rect class="actor-box" x="10" y="75" width="60" height="50" fill="#e74c3c" />
            <text class="actor-label" x="40" y="103" text-anchor="middle" font-size="12">Service</text>
        </g>

        <g class="actor" data-actor="hsdir">
            <rect class="actor-box" x="110" y="10" width="60" height="40" fill="#9b59b6" />
            <text class="actor-label" x="140" y="35" text-anchor="middle" font-size="12">HSDir</text>
        </g>

        <g class="actor" data-actor="ip">
            <rect class="actor-box" x="100" y="150" width="80" height="40" fill="#e67e22" />
            <text class="actor-label" x="140" y="175" text-anchor="middle" font-size="11">Intro Point</text>
        </g>

        <g class="actor" data-actor="rp">
            <rect class="actor-box" x="110" y="75" width="60" height="50" fill="#27ae60" />
            <text class="actor-label" x="140" y="98" text-anchor="middle" font-size="10">Rendez-</text>
            <text class="actor-label" x="140" y="112" text-anchor="middle" font-size="10">vous</text>
        </g>

        <g class="actor" data-actor="client">
            <rect class="actor-box" x="210" y="75" width="60" height="50" fill="#3498db" />
            <text class="actor-label" x="240" y="103" text-anchor="middle" font-size="12">Client</text>
        </g>

        <path class="flow-path" data-flow="1" d="M 55 75 Q 80 40 110 30" stroke="#9b59b6" marker-end="url(#arr-p)" />
        <path class="flow-path" data-flow="1" d="M 55 125 Q 70 160 100 170" stroke="#e67e22" marker-end="url(#arr-o)" />
        <path class="flow-path" data-flow="2" d="M 225 75 Q 200 40 170 30" stroke="#9b59b6" marker-end="url(#arr-p)" />
        <path class="flow-path" data-flow="3" d="M 210 100 L 170 100" stroke="#27ae60" marker-end="url(#arr-g)" />
        <path class="flow-path" data-flow="4" d="M 230 125 Q 200 160 180 170" stroke="#e67e22" marker-end="url(#arr-o)" />
        <path class="flow-path" data-flow="4" d="M 100 165 Q 60 150 50 125" stroke="#e67e22" marker-end="url(#arr-o)" />
        <path class="flow-path" data-flow="5" d="M 70 100 L 110 100" stroke="#27ae60" marker-end="url(#arr-g)" />
        <path class="flow-path" data-flow="6" d="M 70 92 L 110 92" stroke="#3498db" marker-end="url(#arr-b)" />
        <path class="flow-path" data-flow="6" d="M 170 108 L 210 108" stroke="#3498db" marker-end="url(#arr-b)" />
    </svg>

    <div class="onion-rv-desc" id="rv-desc"></div>
</div>

{{ $onionScript := resources.Get "js/onion-rendezvous.js" | minify | fingerprint }}
<script src="{{ $onionScript.RelPermalink }}" integrity="{{ $onionScript.Data.Integrity }}" crossorigin="anonymous"></script>
